@using System.Text.Json
@using Microsoft.JSInterop
@inject IJSRuntime JS

@code {
    private List<GiftItem> Gifts = new()
    {
        new GiftItem("Kitchen Mixer"),
        new GiftItem("Cutlery Set"),
        new GiftItem("Gift Card - Home Store"),
        new GiftItem("Toaster"),
    };

    private const string StorageKey = "wedding_gifts_v1";

    protected override async Task OnInitializedAsync()
    {
        var json = await JS.InvokeAsync<string>("localStorageFunctions.getItem", StorageKey);
        if (!string.IsNullOrEmpty(json))
        {
            try
            {
                var stored = JsonSerializer.Deserialize<List<GiftItem>>(json);
                if (stored != null)
                    Gifts = stored;
            }
            catch { /* ignore parse errors and use defaults */ }
        }
    }

    private async Task ToggleChecked(GiftItem item)
    {
        item.Checked = !item.Checked;
        await Persist();
    }

    private async Task Persist()
    {
        var json = JsonSerializer.Serialize(Gifts);
        await JS.InvokeVoidAsync("localStorageFunctions.setItem", StorageKey, json);
    }

    private async Task Reset()
    {
        foreach (var g in Gifts) g.Checked = false;
        await Persist();
    }
}

<div class="mb-3">
    <button class="btn btn-sm btn-outline-secondary me-2" @onclick="Reset">Reset checks</button>
    <small class="text-muted">Checks are stored in your browser only.</small>
</div>

<ul class="list-group">
    @foreach (var gift in Gifts)
    {
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <input class="form-check-input me-2" type="checkbox" checked="@gift.Checked" @onclick="() => ToggleChecked(gift)" />
                <span>@gift.Name</span>
            </div>
            <span class="badge bg-@((gift.Checked) ? "success" : "secondary")">@((gift.Checked) ? "Reserved" : "Available")</span>
        </li>
    }
</ul>

@code {
    public record GiftItem(string Name)
    {
        public bool Checked { get; set; }
    }
}